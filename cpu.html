<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Obito CPU</title>
<style>
  :root{
    --accent:#00ff99;
    --accent-2:#6ef0ff;
    --bg:#050505;
    --card:bg: rgba(20,20,20,0.85);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Inter", "Segoe UI", Roboto, sans-serif;
    background: linear-gradient(180deg,#000,#06110a);
    color:#e8fff3;
    -webkit-font-smoothing:antialiased;
    overflow:hidden;
  }

  /* canvas particles behind everything */
  canvas#bgCanvas{
    position:fixed; inset:0; z-index:0;
  }

  /* header */
  header.topbar{
    position:relative; z-index:3;
    display:flex; align-items:center; gap:14px;
    padding:18px 20px;
    background: linear-gradient(90deg, rgba(0,0,0,0.35), rgba(0,0,0,0.2));
    border-bottom:1px solid rgba(0,255,153,0.06);
    backdrop-filter: blur(6px);
  }
  .logo {
    width:64px; height:64px; border-radius:14px;
    overflow:hidden; flex:0 0 64px;
    border:2px solid rgba(0,255,153,0.12);
    box-shadow:0 6px 24px rgba(0,255,153,0.06), inset 0 0 30px rgba(0,255,153,0.03);
  }
  .logo img{width:100%;height:100%;object-fit:cover;display:block}
  .headtext{flex:1}
  .title{font-weight:700;font-size:18px;letter-spacing:0.4px;color:var(--accent)}
  .sub{font-size:12px;color:#bfeede;margin-top:4px;opacity:.9}

  /* layout */
  .wrap{
    position:relative; z-index:2;
    display:flex; gap:20px;
    padding:18px;
    height: calc(100vh - 128px);
  }

  /* left column (file manager) */
  .left{
    width:420px;
    min-width:320px;
    max-height:100%;
    overflow:hidden;
  }

  .card{
    background: linear-gradient(180deg, rgba(10,10,10,0.72), rgba(8,8,8,0.6));
    border-radius:14px;
    padding:16px;
    box-shadow: 0 10px 40px rgba(0,255,153,0.03);
    border:1px solid rgba(0,255,153,0.04);
    margin-bottom:18px;
  }

  .card h3{ margin:0 0 10px 0; color:var(--accent); font-size:14px; font-weight:700}
  .controls{ display:flex; gap:10px; align-items:center }

  .btn{
    padding:10px 14px; border-radius:10px; border: none;
    background: linear-gradient(135deg,#0b5,#087);
    color:#001; font-weight:700; cursor:pointer; box-shadow:0 6px 18px rgba(0,255,153,0.12);
  }
  .btn.gray{
    background: linear-gradient(135deg,#222,#181818);
    color:#ddd; box-shadow:none; border:1px solid rgba(255,255,255,0.03)
  }
  .btn.warn{
    background: linear-gradient(135deg,#ff7a7a,#ff3a3a);
    color:white;
  }

  .file-input{
    display:flex; gap:8px; align-items:center;
    margin-top:10px;
  }
  input[type="file"]{ display:none }

  .file-list{
    margin-top:12px; max-height:420px; overflow:auto; padding-right:6px;
  }
  .file-item{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px; margin-bottom:8px; border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px solid rgba(255,255,255,0.02);
  }
  .file-left{ display:flex; gap:10px; align-items:center; min-width:0 }
  .thumb{
    width:44px; height:44px; border-radius:8px; background:linear-gradient(135deg,#062,#024);
    display:flex; align-items:center; justify-content:center; font-weight:800; color:#bfffe6;
    flex:0 0 44px;
  }
  .meta{ min-width:0 }
  .meta .name{ font-size:14px; color:#eafbf4; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; max-width:200px }
  .meta .size{ font-size:12px; color:#9fcfb6; margin-top:3px }

  .file-actions{ display:flex; gap:8px; align-items:center }
  .icon-btn{
    border:none; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700;
    background:linear-gradient(135deg,#111,#090); color:#dfffe8;
  }
  .icon-btn.del{ background:linear-gradient(135deg,#2b0000,#5a0000); color:#ffdede }

  /* progress modal inside item */
  .progress{
    margin-top:8px; height:10px; background:rgba(255,255,255,0.03);
    border-radius:6px; overflow:hidden;
  }
  .bar{ height:100%; width:0%; background:linear-gradient(90deg,#00ff99,#6ef0ff); transition: width .2s ease; }

  /* right column (preview / info) */
  .right{ flex:1; min-width:360px; max-height:100%; overflow:auto }
  .preview{
    padding:18px;
    border-radius:14px;
    background: linear-gradient(180deg, rgba(10,10,10,0.7), rgba(5,5,5,0.5));
    border:1px solid rgba(110,240,255,0.04);
  }
  .preview h3{ color:var(--accent-2); margin-top:0 }

  /* bottom nav */
  .bottom{
    position:fixed; left:0; right:0; bottom:0; height:68px; z-index:5;
    display:flex; align-items:center; justify-content:center; gap:16px;
    background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.8));
    border-top:1px solid rgba(0,255,153,0.04);
  }
  .tab{
    padding:10px 18px; border-radius:12px; color:#bfffe8; font-weight:700; text-decoration:none;
    background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.006));
    border:1px solid rgba(255,255,255,0.02)
  }
  .tab.active{ background: linear-gradient(135deg,#00ff99,#6ef0ff); color:#012; box-shadow:0 8px 24px rgba(0,255,153,0.12) }

  /* small helpers */
  .muted{ color:#9fbfa6; font-size:13px }
  .center{ text-align:center }

  /* responsive */
  @media (max-width:900px){
    .wrap{ flex-direction:column; padding-bottom:86px; height:auto }
    .left{ width:100% }
    .right{ width:100% }
  }
</style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>

  <header class="topbar">
    <div class="logo"><img src="Logo.png" alt="logo"></div>
    <div style="flex:1">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
        <div>
          <div class="title" style="font-weight:800;color:var(--accent);font-size:18px">OBITO PANEL</div>
          <div class="muted">Nhanh • An toàn • Ổn định</div>
        </div>
        <div style="text-align:right">
          <div class="muted">ADMIN: NhismDev</div>
          <div class="muted" id="timeNow"></div>
        </div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- left column -->
    <div class="left">
      <!-- File manager card -->
      <div class="card">
        <h3>Quản lý tệp inject</h3>
        <div class="controls">
          <label class="btn gray" for="fileInput">+ Thêm tệp</label>
          <input type="file" id="fileInput" multiple />
          <button class="btn" id="exportBtn">⬇ Xuất tệp (files.dpi.js)</button>
          <button class="btn warn" id="clearBtn">Xóa tất cả</button>
        </div>

        <div class="file-input muted">Các tệp được chọn sẽ hiện ở đây — có thể Inject hoặc Xóa từng tệp.</div>

        <div class="file-list" id="fileList"></div>
      </div>

      <!-- quick actions -->
      <div class="card">
        <h3>Nhanh</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn" id="autoInjectAll">Inject toàn bộ</button>
          <button class="btn gray" id="stopAll">Dừng</button>
          <button class="btn" id="openRepo">Mở repo</button>
        </div>
      </div>
    </div>

    <!-- right column -->
    <div class="right">
      <div class="preview card">
        <h3>Thông tin tệp</h3>
        <div id="previewArea" class="muted">Chọn tệp để xem thông tin chi tiết ở đây.</div>
        <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0" />
        <div>
          <h3>Trạng thái Inject</h3>
          <div id="globalStatus" class="muted">Chưa có hoạt động.</div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card center">
        <h3>Gợi ý</h3>
        <div class="muted">Tệp xuất ra định dạng <b>files.dpi.js</b> (JS chứa object JSON). Tải file về và dùng theo hướng dẫn của bạn.</div>
      </div>
    </div>
  </div>

  <!-- bottom nav -->
  <div class="bottom">
    <a class="tab active">Panel</a>
    <a class="tab" href="cpu.html">CPU</a>
    <a class="tab" href="index.html">Home</a>
  </div>

<script>
/* ===== time show ===== */
function updateTime(){ document.getElementById('timeNow').textContent = new Date().toLocaleString(); }
setInterval(updateTime,1000); updateTime();

/* ===== particle background (nice, soft) ===== */
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
window.addEventListener('resize', resize); resize();

const pts = [];
for(let i=0;i<130;i++){
  pts.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2+0.5,
    vy: Math.random()*0.6+0.1,
    vx: (Math.random()-0.5)*0.2,
    o: Math.random()*0.6+0.2
  });
}
function frame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // subtle radial gradient center
  const g = ctx.createRadialGradient(canvas.width/2,canvas.height/2,100, canvas.width/2,canvas.height/2, Math.max(canvas.width,canvas.height));
  g.addColorStop(0,'rgba(0,40,20,0.06)');
  g.addColorStop(1,'rgba(0,0,0,0.3)');
  ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

  for(const p of pts){
    p.y += p.vy; p.x += p.vx;
    if(p.y > canvas.height+10){ p.y = -10; p.x = Math.random()*canvas.width; }
    if(p.x < -10) p.x = canvas.width+10; if(p.x > canvas.width+10) p.x = -10;
    ctx.beginPath();
    ctx.fillStyle = 'rgba(0,255,153,'+p.o+')';
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(frame);
}
frame();

/* ===== file manager logic ===== */
const fileInput = document.getElementById('fileInput');
const fileListEl = document.getElementById('fileList');
const exportBtn = document.getElementById('exportBtn');
const clearBtn = document.getElementById('clearBtn');
const autoInjectAll = document.getElementById('autoInjectAll');
const previewArea = document.getElementById('previewArea');
const globalStatus = document.getElementById('globalStatus');

let files = []; // array of { id, file, content (base64), status, progress }

function uid(){ return 'f'+Math.random().toString(36).slice(2,9); }

fileInput.addEventListener('change', async (e)=>{
  const list = Array.from(e.target.files);
  for(const f of list){
    const id = uid();
    const content = await readFileAsBase64(f);
    files.push({ id, name: f.name, size: f.size, type: f.type, file: f, content, status:'idle', progress:0 });
  }
  renderFileList();
  fileInput.value = '';
});

function readFileAsBase64(file){
  return new Promise((res,rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result.split(',')[1]);
    r.onerror = ()=> rej('ERR');
    r.readAsDataURL(file);
  });
}

function renderFileList(){
  fileListEl.innerHTML = '';
  if(files.length === 0){
    fileListEl.innerHTML = '<div class="muted">Chưa có Config nào. Ấn "Thêm tệp" để chọn.</div>'; return;
  }
  for(const f of files){
    const el = document.createElement('div'); el.className='file-item';
    const left = document.createElement('div'); left.className='file-left';
    const thumb = document.createElement('div'); thumb.className='thumb'; thumb.textContent = f.name.split('.')[0].slice(0,3).toUpperCase();
    const meta = document.createElement('div'); meta.className='meta';
    const nm = document.createElement('div'); nm.className='name'; nm.textContent = f.name;
    const sz = document.createElement('div'); sz.className='size'; sz.textContent = formatBytes(f.size);
    meta.appendChild(nm); meta.appendChild(sz);
    left.appendChild(thumb); left.appendChild(meta);

    const actions = document.createElement('div'); actions.className='file-actions';
    const injectBtn = document.createElement('button'); injectBtn.className='icon-btn'; injectBtn.textContent='Inject';
    const delBtn = document.createElement('button'); delBtn.className='icon-btn del'; delBtn.textContent='Xóa';

    injectBtn.onclick = ()=> startInject(f.id);
    delBtn.onclick = ()=> { files = files.filter(x=>x.id!==f.id); renderFileList(); };

    actions.appendChild(injectBtn); actions.appendChild(delBtn);

    el.appendChild(left);
    el.appendChild(actions);

    // progress area
    const progWrap = document.createElement('div'); progWrap.style.width='100%';
    const progressBar = document.createElement('div'); progressBar.className='progress'; progressBar.style.display='none';
    const inner = document.createElement('div'); inner.className='bar'; progressBar.appendChild(inner);
    progWrap.appendChild(progressBar);
    el.appendChild(progWrap);

    // attach dataset for later update
    el.dataset.id = f.id;
    fileListEl.appendChild(el);
  }
}

/* start inject: simulate progress 0->100 */
function startInject(id){
  const f = files.find(x=>x.id===id); if(!f) return;
  if(f.status === 'running') return;
  f.status='running'; f.progress=0;
  globalStatus.textContent = `⚙️ Đang inject: ${f.name}`;
  // show progress UI
  const el = fileListEl.querySelector(`.file-item[data-id="${id}"]`);
  const prog = el.querySelector('.progress'); const bar = el.querySelector('.bar');
  prog.style.display = 'block'; bar.style.width = '0%';
  // simulate progress smoothly
  const interval = setInterval(()=>{
    if(f.progress >= 100){ clearInterval(interval); 
      f.status='done'; globalStatus.textContent = `✅ Hoàn thành: ${f.name} — Free Fire Sẵn Sàng`;
      bar.style.width = '100%'; setTimeout(()=>{ prog.style.display='none'; bar.style.width='0%'; },1200);
      // show small toast
      showTmp(`${f.name} — Hoàn thành`, 2000);
      return;
    }
    // variable increment for smoothness
    f.progress += Math.floor(Math.random()*6)+2; if(f.progress>100) f.progress=100;
    bar.style.width = f.progress + '%';
  }, 120);
}

/* export files to files.dpi.js (JS file with JSON payload) */
exportBtn.addEventListener('click', ()=>{
  if(files.length===0){ alert('Không có tệp để xuất'); return; }
  // build object
  const data = {};
  files.forEach(f=>{
    data[f.name] = { size: f.size, type: f.type, content_base64: f.content };
  });
  const content = 'window.DPI_FILES = ' + JSON.stringify(data, null, 2) + ';';
  const blob = new Blob([content], { type: 'application/javascript' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'files.dpi.js'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* clear all */
clearBtn.addEventListener('click', ()=>{
  if(!confirm('Xóa tất cả tệp trong danh sách?')) return;
  files = []; renderFileList(); previewArea.textContent = 'Danh sách trống.';
});

/* auto inject all */
autoInjectAll.addEventListener('click', ()=>{
  if(files.length===0){ alert('Không có tệp'); return; }
  // sequential inject
  (async function seq(){
    for(const f of [...files]){
      await new Promise(res=>{
        startInject(f.id);
        const check = setInterval(()=>{ if(f.status==='done'){ clearInterval(check); setTimeout(res,300); } }, 200);
      });
    }
  })();
});

/* open repo (example) */
document.getElementById('openRepo').addEventListener('click', ()=> window.open('https://github.com/quinhat12/ff-menu','_blank') );

/* helpers */
function formatBytes(bytes,dec=1){
  if(bytes===0) return '0 B';
  const k=1024, dm=dec<0?0:dec, sizes=['B','KB','MB','GB','TB'];
  const i=Math.floor(Math.log(bytes)/Math.log(k));
  return parseFloat((bytes/Math.pow(k,i)).toFixed(dm)) + ' ' + sizes[i];
}
function showTmp(msg, time=1500){
  const t = document.createElement('div');
  t.textContent = msg; t.style.position='fixed'; t.style.right='18px'; t.style.top='18px';
  t.style.background='linear-gradient(90deg,#0f0,#6ef0ff)'; t.style.color='#012'; t.style.padding='10px 14px';
  t.style.borderRadius='10px'; t.style.zIndex=9999; document.body.appendChild(t);
  setTimeout(()=>{ t.style.transition='opacity .4s'; t.style.opacity='0'; setTimeout(()=>t.remove(),450) }, time);
}

/* preview on click */
fileListEl.addEventListener('click', (ev)=>{
  let item = ev.target;
  while(item && !item.classList.contains('file-item')) item = item.parentElement;
  if(!item) return;
  const id = item.dataset.id; const f = files.find(x=>x.id===id);
  if(!f) return;
  previewArea.innerHTML = `<div><b>${escapeHtml(f.name)}</b></div>
  <div class="muted">Kích thước: ${formatBytes(f.size)} — Loại: ${f.type||'unknown'}</div>
  <div style="margin-top:8px; font-size:13px; color:#cfeee0">Base64 (rút gọn): ${String(f.content).slice(0,120)}...</div>`;
});

function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

/* init empty list */
renderFileList();
</script>
</body>
</html>
