<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPU — Ultra Boost</title>
  <style>
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: black; color: white; }
    #matrix { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; background:#001a00; }
    .container { max-width: 900px; margin: 20px auto; padding: 20px; position: relative; z-index:1; }

    /* Header */
    .header { display:flex; align-items:center; justify-content:center; margin-bottom:20px; }
    .team-info h1 { font-size:22px; margin:0; color:#0f0; text-align:center; text-shadow:0 0 10px #0f0; }

    /* Floating buttons */
    .floating-btn {
      position: fixed; top: 15px; width: 50px; height: 50px; border: none; border-radius: 50%;
      cursor: pointer; font-size: 22px; font-weight: bold; display: flex; align-items: center; justify-content: center;
      transition: 0.3s; z-index: 10;
    }
    .back-btn { left: 15px; background: radial-gradient(circle at 30% 30%, #00ff99, #008844); color: black;
      box-shadow: 0 0 15px rgba(0,255,153,0.6), inset 0 0 8px rgba(0,255,153,0.4); }
    .back-btn:hover { transform: scale(1.15) rotate(-5deg); box-shadow: 0 0 25px rgba(0,255,153,1), 0 0 40px rgba(0,255,153,0.6); }
    .vip-btn { right: 15px; background: radial-gradient(circle at 30% 30%, #FFD700, #FF8C00); color: black;
      box-shadow: 0 0 15px rgba(255,215,0,0.8), inset 0 0 8px rgba(255,200,0,0.5); animation: pulse 2s infinite; }
    .vip-btn:hover { transform: scale(1.15) rotate(5deg); box-shadow: 0 0 25px rgba(255,215,0,1), 0 0 40px rgba(255,180,0,0.9); }
    @keyframes pulse { 0%{box-shadow:0 0 15px rgba(255,215,0,0.8);} 50%{box-shadow:0 0 35px rgba(255,215,0,1);} 100%{box-shadow:0 0 15px rgba(255,215,0,0.8);} }

    /* Stats */
    .stats { display:flex; justify-content:space-around; background:rgba(0,30,0,0.85); padding:15px; border-radius:12px; box-shadow:0 0 10px rgba(0,255,100,0.2); margin:20px 0; }
    .stats div { text-align:center; }

    /* Toolbar + Files panel (MỚI) */
    .toolbar { display:flex; gap:10px; justify-content:center; margin:10px 0 15px; flex-wrap: wrap; }
    .file-btn { padding:10px 14px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; box-shadow: 0 0 12px rgba(0,255,153,0.3); }
    .file-btn.add { background:#00ff66; color:#000; }
    .file-btn.export { background:#00ccff; color:#000; }
    .files-panel { background:rgba(0,30,0,0.75); padding:12px; border-radius:12px; box-shadow:0 0 12px rgba(0,255,153,0.15); }
    .files-panel h3 { margin:0 0 10px; color:#0f0; text-shadow:0 0 8px #0f0; text-align:center; }
    .file-list.empty { color:#aaa; text-align:center; }
    .file-item { display:flex; justify-content:space-between; align-items:center; padding:10px; background:rgba(0,0,0,0.4); border-radius:10px; margin-bottom:8px; }
    .file-item .meta .name { font-weight:600; }
    .file-item .meta .sub { font-size:12px; color:#bbb; }
    .file-item .actions button { margin-left:6px; padding:6px 10px; border:none; border-radius:8px; cursor:pointer; }
    .file-item .actions .inject { background:#00ff66; color:#000; }
    .file-item .actions .download { background:#ffaa00; color:#000; }
    .file-item .actions .remove { background:#ff5555; color:#000; }

    /* Games */
    .games { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }
    .game-card { background:rgba(0,30,0,0.85); border-radius:15px; padding:15px; width:250px; box-shadow:0 0 15px rgba(0,255,100,0.2); }
    .game-card img { width:60px; height:60px; border-radius:12px; margin-bottom:10px; }
    .game-title { font-weight:bold; margin:5px 0; }
    .game-stats { display:flex; justify-content:space-between; font-size:12px; margin:5px 0; }
    .game-stats .fps strong { color:#0f0; text-shadow:0 0 5px #0f0; }
    .game-stats .ping strong { color:#0ff; text-shadow:0 0 5px #0ff; }
    .game-info { font-size:12px; color:#aaa; margin-bottom:10px; }
    .start-btn { background:#00ff66; color:#000; font-weight:bold; padding:8px 12px; border:none; border-radius:8px; cursor:pointer; width:100%; transition:0.3s; }
    .start-btn:hover { background:#00cc55; transform:scale(1.05); }

    /* Popup */
    .popup { position:fixed; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.7); z-index:5; opacity:0; visibility:hidden; transition:.3s; }
    .popup.show { opacity:1; visibility:visible; }
    .popup-box { background:rgba(0,20,0,0.95); padding:20px; border-radius:12px; width:300px; text-align:center; box-shadow:0 0 20px rgba(0,255,100,0.3); }
    .progress { width:100%; height:20px; background:#222; border-radius:10px; margin:15px 0; overflow:hidden; }
    .progress-bar { height:100%; width:0%; background:#00ff66; transition:width .2s; }
    .close-btn { display:none; background:#111; color:white; border:1px solid #0f0; padding:8px 12px; border-radius:8px; cursor:pointer; margin-top:10px; }
    .close-btn:hover { background:#0f0; color:#000; }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>

  <!-- Floating buttons -->
  <button class="floating-btn back-btn" onclick="window.location.href='panel.html'">☰</button>
  <button class="floating-btn vip-btn">★</button>

  <div class="container">
    <!-- Header -->
    <div class="header"><div class="team-info"><h1>CPU — Ultra Boost</h1></div></div>

    <!-- Stats -->
    <div class="stats">
      <div><div>Ứng dụng</div><strong>2</strong></div>
      <div><div>Favorites</div><strong>0</strong></div>
      <div><div>Lượt chạy</div><strong>0</strong></div>
      <div><div>Lần gần nhất</div><strong>—</strong></div>
    </div>

    <!-- ===== Toolbar & Files panel (MỚI) ===== -->
    <div class="toolbar">
      <button class="file-btn add" onclick="document.getElementById('fileInput').click()">+ Thêm tệp</button>
      <button class="file-btn export" onclick="exportFiles()">Xuất tệp</button>
      <input id="fileInput" type="file" multiple style="display:none" onchange="handleAddFiles(event)">
    </div>

    <div class="files-panel">
      <h3>Tệp của bạn</h3>
      <div id="fileList" class="file-list empty">Chưa có tệp nào. Ấn "Thêm tệp".</div>
    </div>
    <!-- ===== End Files panel ===== -->

    <!-- Games -->
    <div class="games">
      <div class="game-card">
        <img src="ffmax.jpg" alt="Free Fire">
        <div class="game-title">Free Fire</div>
        <div class="game-stats"><span>FPS: <strong id="ff-fps">0</strong></span><span>Ping: <strong id="ff-ping">0ms</strong></span></div>
        <div class="game-info">Super game optimization</div>
        <button class="start-btn" onclick="startOptimize('Free Fire','ff')">Bắt đầu</button>
      </div>
      <div class="game-card">
        <img src="ffmax.jpg" alt="Free Fire MAX">
        <div class="game-title">Free Fire MAX</div>
        <div class="game-stats"><span>FPS: <strong id="ffmax-fps">0</strong></span><span>Ping: <strong id="ffmax-ping">0ms</strong></span></div>
        <div class="game-info">Super game optimization</div>
        <button class="start-btn" onclick="startOptimize('Free Fire MAX','ffmax')">Bắt đầu</button>
      </div>
    </div>
  </div>

  <!-- Popup -->
  <div class="popup" id="popup">
    <div class="popup-box">
      <h3 id="popupTitle">Đang tối ưu...</h3>
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      <div id="progressText">0%</div>
      <button class="close-btn" id="closeBtn">Đóng</button>
    </div>
  </div>

  <script>
    /* ====== GAMES: giữ nguyên logic tối ưu cũ ====== */
    function startOptimize(game,id) {
      const popup = document.getElementById("popup");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      const popupTitle = document.getElementById("popupTitle");
      const closeBtn = document.getElementById("closeBtn");

      popup.classList.add("show");
      popupTitle.textContent = "Đang tối ưu " + game + "...";
      progressBar.style.width = "0%";
      progressText.textContent = "0%";
      closeBtn.style.display = "none";

      let progress = 0;
      const interval = setInterval(() => {
        progress += 5;
        progressBar.style.width = progress + "%";
        progressText.textContent = progress + "%";
        if (progress >= 100) {
          clearInterval(interval);
          popupTitle.textContent = "✅ Tối ưu " + game + " thành công!";
          closeBtn.style.display = "inline-block";

          const fps = Math.floor(55 + Math.random() * 15);
          const ping = Math.floor(10 + Math.random() * 40);
          document.getElementById(id + "-fps").textContent = fps;
          document.getElementById(id + "-ping").textContent = ping + "ms";
        }
      }, 200);
    }
    document.getElementById("closeBtn").addEventListener("click", () => {
      document.getElementById("popup").classList.remove("show");
    });

    /* ====== Particles nền giữ nguyên ====== */
    const canvas=document.getElementById("matrix");const ctx=canvas.getContext("2d");
    function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;}
    resizeCanvas();window.addEventListener("resize",resizeCanvas);
    const particles=[];const numParticles=80;
    class Particle{constructor(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.radius=2;this.dx=(Math.random()-.5)*1.5;this.dy=(Math.random()-.5)*1.5;}
    draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.radius,0,Math.PI*2);ctx.fillStyle="#00ff99";ctx.shadowColor="#00ff99";ctx.shadowBlur=15;ctx.fill();ctx.closePath();}
    update(){this.x+=this.dx;this.y+=this.dy;if(this.x<0||this.x>canvas.width)this.dx*=-1;if(this.y<0||this.y>canvas.height)this.dy*=-1;this.draw();}}
    function connect(){for(let a=0;a<particles.length;a++){for(let b=a;b<particles.length;b++){const dx=particles[a].x-particles[b].x;const dy=particles[a].y-particles[b].y;const dist=Math.sqrt(dx*dx+dy*dy);if(dist<120){ctx.beginPath();ctx.strokeStyle="rgba(0,255,153,0.2)";ctx.moveTo(particles[a].x,particles[a].y);ctx.lineTo(particles[b].x,particles[b].y);ctx.stroke();ctx.closePath();}}}}
    function init(){for(let i=0;i<numParticles;i++)particles.push(new Particle());}
    function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>p.update());connect();requestAnimationFrame(animate);}
    init();animate();

    /* ====== FILES: Add / Export / Inject / Persist (MỚI) ====== */
    const STORE_KEY = 'ak_files_v1';
    let filesStore = [];

    // Load saved files from localStorage
    function loadStore(){
      try { filesStore = JSON.parse(localStorage.getItem(STORE_KEY)) || []; }
      catch(e){ filesStore = []; }
      updateFilesUI();
    }
    function saveStore(){ localStorage.setItem(STORE_KEY, JSON.stringify(filesStore)); }

    // Handle Add files
    function handleAddFiles(e){
      const files = Array.from(e.target.files || []);
      if (!files.length) return;

      // Hỗ trợ: nếu chọn 1 JSON export trước đó -> import hàng loạt
      Promise.all(files.map(f => {
        if ((f.type === 'application/json') || f.name.toLowerCase().endsWith('.json')) {
          return readText(f).then(text => {
            try {
              const obj = JSON.parse(text);
              if (obj && obj.files && Array.isArray(obj.files)) {
                // Import archive
                return { importArchive: obj.files.map(it => ({...it, id: cryptoRandomId()})) };
              }
            } catch(_) {}
            // Nếu chỉ là json thường -> lưu như file bình thường
            return readFileAsBase64(f);
          });
        }
        return readFileAsBase64(f);
      })).then(results => {
        results.forEach(r => {
          if (r.importArchive) r.importArchive.forEach(item => filesStore.push(item));
          else filesStore.push(r);
        });
        saveStore(); updateFilesUI(); e.target.value='';
      }).catch(err => {
        console.error(err);
        alert('Không thể thêm tệp.');
      });
    }

    // Inject (giả lập) theo từng file, dùng popup sẵn có
    function injectFile(id){
      const f = filesStore.find(x => x.id === id);
      if(!f) return;
      const popup = document.getElementById("popup");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      const popupTitle = document.getElementById("popupTitle");
      const closeBtn = document.getElementById("closeBtn");

      popup.classList.add("show");
      popupTitle.textContent = "Đang inject " + f.name + "...";
      progressBar.style.width = "0%";
      progressText.textContent = "0%";
      closeBtn.style.display = "none";

      let progress = 0;
      const interval = setInterval(()=>{
        progress += 7;
        progressBar.style.width = progress + "%";
        progressText.textContent = progress + "%";
        if (progress >= 100){
          clearInterval(interval);
          popupTitle.textContent = "✅ Inject " + f.name + " thành công!";
          closeBtn.style.display = "inline-block";
        }
      }, 180);
    }

    // Export toàn bộ filesStore -> JSON
    function exportFiles(){
      if (!filesStore.length){ alert('Chưa có tệp nào để xuất.'); return; }
      const payload = { version:1, exported_at:new Date().toISOString(), files: filesStore };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type:'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'files-export.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(a.href);
    }

    // Download lại 1 file
    function downloadFile(id){
      const f = filesStore.find(x => x.id === id);
      if(!f) return;
      const blob = base64ToBlob(f.data, f.type || 'application/octet-stream');
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = f.name;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // Xoá file khỏi danh sách
    function removeFile(id){
      filesStore = filesStore.filter(x => x.id !== id);
      saveStore(); updateFilesUI();
    }

    // UI render danh sách tệp
    function updateFilesUI(){
      const list = document.getElementById('fileList');
      if (!filesStore.length){
        list.classList.add('empty');
        list.textContent = 'Chưa có tệp nào. Ấn "Thêm tệp".';
        return;
      }
      list.classList.remove('empty');
      list.innerHTML = filesStore.map(f => `
        <div class="file-item">
          <div class="meta">
            <div class="name">${escapeHtml(f.name)}</div>
            <div class="sub">${(f.size/1024).toFixed(1)} KB • ${escapeHtml(f.type || 'file')}</div>
          </div>
          <div class="actions">
            <button class="inject" onclick="injectFile('${f.id}')">Inject</button>
            <button class="download" onclick="downloadFile('${f.id}')">Tải</button>
            <button class="remove" onclick="removeFile('${f.id}')">Xoá</button>
          </div>
        </div>
      `).join('');
    }

    /* Helpers */
    function readFileAsBase64(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const base64 = arrayBufferToBase64(reader.result);
          resolve({ id: cryptoRandomId(), name: file.name, size: file.size, type: file.type || 'application/octet-stream', data: base64 });
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }
    function readText(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsText(file);
      });
    }
    function arrayBufferToBase64(buf){
      let binary=''; const bytes=new Uint8Array(buf);
      const len=bytes.byteLength; for(let i=0;i<len;i++){ binary+=String.fromCharCode(bytes[i]); }
      return btoa(binary);
    }
    function base64ToBlob(base64, type){
      const binary = atob(base64);
      const len = binary.length;
      const bytes = new Uint8Array(len);
      for (let i=0;i<len;i++) bytes[i] = binary.charCodeAt(i);
      return new Blob([bytes], {type});
    }
    function cryptoRandomId(){ return Math.random().toString(36).slice(2) + Date.now().toString(36); }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    // Init
    loadStore();
  </script>
</body>
</html>
